---
title: "Table 1"
date: "Last compiled on `r format(Sys.time(), '%B, %Y')`"
output: 
  html_document:
    css: tweaks.css
    toc:  true
    toc_float: true
    number_sections: true
    code_folding: show
    code_download: yes
    
---  



```{r, globalsettings, echo=FALSE, warning=FALSE, message=FALSE, results='hide'}

library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=100),tidy=TRUE, warning = FALSE, message = FALSE,comment = "#>", cache=TRUE, class.source=c("test"), class.output=c("test2"), cache.lazy = FALSE)
options(width = 100)
rgl::setupKnitr()

colorize <- function(x, color) {sprintf("<span style='color: %s;'>%s</span>", color, x) }

```

```{r klippy, echo=FALSE, include=TRUE, eval=TRUE}
klippy::klippy(position = c('top', 'right'))
#klippy::klippy(color = 'darkred')
#klippy::klippy(tooltip_message = 'Click to copy', tooltip_success = 'Done')
```


----

This lab journal replicates table 1. 
  

----

# Custom functions

- `fpackage.check`: Check if packages are installed (and install if not) in R ([source](https://vbaliga.github.io/verify-that-r-packages-are-installed-and-loaded/)).  


```{r, results='hide'}

rm(list = ls())

fpackage.check <- function(packages) {
  lapply(packages, FUN = function(x) {
    if (!require(x, character.only = TRUE)) {
      install.packages(x, dependencies = TRUE)
      library(x, character.only = TRUE)
    }
  })
}


```


---  

# Packages

- `tidyverse`: tidy data manipulations
- `kableExtra`: creating tables in consistent formatting


```{r, results='hide'}

packages = c("tidyverse", "kableExtra")

fpackage.check(packages)

```


--- 

# Input



We use one processed dataset.

* [df_starting.rda](): dataset of PhDs with all relevant variables: gender + ethnicity + university + PhD year  
    - For construction of this dataset see [(datapreparations.html)]  
    - name of dataset: `df_starting` 
    

```{r data}

load(file = "./data/processed/df_starting.rda")

```




# Tables


## Table 1

Descriptives

```{r}

columns <- c("Min", "Max", "Mean", "SD")

rows <- c("Gender (ref=men)", "Women", "Missing","Ethnicity (ref=majority)", "Minority", "Caribbean", "Turkish", "Moroccan", "Other", "<strong>PhD Cohort</strong></p>", "University (ref=Erasmus University)", "Leiden University", "Radboud University", "University of Groningen", "Delft University of Technology", "Eindhoven University of Technology", "Tilburg University", "Maastricht University", "University of Twente", "Utrecht University", "University of Amsterdam", "Vrije Universiteit Amsterdam", "Wageningen University and Research Centre", "<strong>Starting to publish</strong></p>", "Source: Dutch Doctoral Database 1990-2018")

t1 <- data.frame(matrix(nrow=length(rows), ncol=length(columns)))

colnames(t1) <- columns
rownames(t1) <- rows


t1[c(2:3),3] <- prop.table(table(df_starting$gender))[2:3] # gender
t1[c(5,9),3] <- prop.table(table(df_starting$ethnicity2))[2:3] # ethnicity
t1[c(6:8),3] <- prop.table(table(df_starting$ethnicity))[2:4] # specific ethnic groups
t1[10,c(1:3)] <- as.numeric(summary(df_starting$phd_cohort)[c(1,6,4)]) # phd cohort
t1[10,4] <- sd(df_starting$phd_cohort) # se phd cohort
t1[c(12:23),3] <- prop.table(table(df_starting$uni))[2:13] # university of doctorate
t1[24,3] <- prop.table(table(df_starting$start_pub))[2] # starting to publish

t1[c(2,3,5:9,12:24),c(1,2)] <- c(rep(0, times=20), rep(1, times=20)) # binary variables min/max


t1[c(1:24),] <- round(t1[c(1:24),],2)

t1[is.na(t1)] <- ""

```


```{r}

t1 %>%
  kable(format = 'html', caption = '<b>Table 1.</b> Descriptive statistics for analyses `starting to publish` (N=85,788)', escape=FALSE) %>%
  row_spec(row=25, italic=T) %>%
  row_spec(row=c(1,4,11), bold=T) %>%
  kable_classic(full_width = F, html_font = "Cambria") %>%
  add_indent(c(6:8), level_of_indent=1) %>%
  kable_styling(font_size = 14) -> table1

table1


```




-----
